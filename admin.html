<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم AYMEN FOOT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0d1117;
            color: #ffffff;
            direction: rtl;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .text-green-500 {
            color: #2ecc71;
        }
        .bg-card {
            background-color: #1a202c;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
        }
        .input-field {
            background-color: #2d3748;
            color: #ffffff;
            border: 1px solid #4a5568;
            padding: 0.75rem;
            border-radius: 0.5rem;
            width: 100%;
        }
        .btn {
            background-color: #2ecc71;
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            text-align: center;
        }
        .btn-red {
            background-color: #e53e3e;
        }
        .btn-yellow {
            background-color: #d69e2e;
        }
        .btn-red:hover {
            background-color: #c53030;
        }
        .btn-yellow:hover {
            background-color: #b7791f;
        }
        .btn:hover {
            background-color: #27ae60;
        }
        .match-type-select {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .form-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .team-list-item, .match-list-item, .league-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #2d3748;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="container">
        <header class="flex items-center justify-between mb-12 border-b-2 border-green-500 pb-4">
            <h1 class="text-3xl font-bold text-green-500">لوحة تحكم AYMEN FOOT</h1>
            <a href="index.html" class="btn text-sm w-auto px-6 py-2">العودة للرئيسية</a>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-10">
            <!-- إدارة الدوريات -->
            <section class="bg-card">
                <h2 class="text-2xl font-bold mb-6 text-center">إدارة الدوريات</h2>
                <form id="add-league-form" class="form-section mb-6">
                    <div>
                        <label for="league-name" class="block text-sm font-medium mb-1">اسم الدوري:</label>
                        <input type="text" id="league-name" class="input-field" required>
                    </div>
                    <button type="submit" class="btn">إضافة دوري</button>
                </form>

                <div>
                    <h3 class="text-xl font-bold mb-4">الدوريات المضافة</h3>
                    <div id="leagues-list" class="space-y-2">
                        <!-- Added leagues will be displayed here -->
                    </div>
                </div>
            </section>
            
            <!-- إدارة المباريات -->
            <section class="bg-card">
                <h2 class="text-2xl font-bold mb-6 text-center">إدارة المباريات</h2>
                <form id="add-match-form" class="form-section">
                    <div>
                        <label for="league" class="block text-sm font-medium mb-1">الدوري:</label>
                        <select id="league" class="input-field" required>
                            <!-- Leagues will be dynamically added here -->
                        </select>
                    </div>
                    <div>
                        <label for="round" class="block text-sm font-medium mb-1">الجولة:</label>
                        <input type="text" id="round" class="input-field" required>
                    </div>
                    <div class="match-type-select">
                        <label class="inline-flex items-center">
                            <input type="radio" name="match-type" value="finished" class="form-radio text-green-500" checked>
                            <span class="ml-2 mr-2">مباراة منتهية</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="match-type" value="upcoming" class="form-radio text-green-500">
                            <span class="ml-2 mr-2">مباراة قادمة</span>
                        </label>
                    </div>
                    <div>
                        <label for="team1" class="block text-sm font-medium mb-1">الفريق الأول:</label>
                        <select id="team1" class="input-field" required>
                            <!-- Teams will be dynamically added here -->
                        </select>
                    </div>
                    <div>
                        <label for="team2" class="block text-sm font-medium mb-1">الفريق الثاني:</label>
                        <select id="team2" class="input-field" required>
                            <!-- Teams will be dynamically added here -->
                        </select>
                    </div>
                    <div id="score-fields">
                        <div>
                            <label for="score1" class="block text-sm font-medium mb-1">نتيجة الفريق الأول:</label>
                            <input type="number" id="score1" class="input-field">
                        </div>
                        <div>
                            <label for="score2" class="block text-sm font-medium mb-1">نتيجة الفريق الثاني:</label>
                            <input type="number" id="score2" class="input-field">
                        </div>
                    </div>
                    <div id="date-time-fields" class="hidden">
                        <div>
                            <label for="date" class="block text-sm font-sm font-medium mb-1">التاريخ:</label>
                            <input type="date" id="date" class="input-field">
                        </div>
                        <div>
                            <label for="time" class="block text-sm font-sm font-medium mb-1">الوقت:</label>
                            <input type="time" id="time" class="input-field">
                        </div>
                    </div>
                    <button type="submit" class="btn">إضافة مباراة</button>
                </form>
                <div class="mt-8">
                    <h3 class="text-xl font-bold mb-4">المباريات المضافة</h3>
                    <div id="matches-list" class="space-y-2">
                         <!-- Matches will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- إدارة الفرق -->
            <section class="bg-card">
                <h2 class="text-2xl font-bold mb-6 text-center">إدارة الفرق</h2>
                <form id="add-team-form" class="form-section mb-6">
                    <div>
                        <label for="team-name" class="block text-sm font-medium mb-1">اسم الفريق:</label>
                        <input type="text" id="team-name" class="input-field" required>
                    </div>
                    <div>
                        <label for="team-logo" class="block text-sm font-medium mb-1">رابط الشعار:</label>
                        <input type="url" id="team-logo" class="input-field" required>
                    </div>
                    <div>
                        <label for="team-league" class="block text-sm font-medium mb-1">الدوري:</label>
                        <select id="team-league" class="input-field" required>
                            <!-- Leagues will be dynamically added here -->
                        </select>
                    </div>
                    <button type="submit" class="btn">إضافة فريق</button>
                </form>

                <div>
                    <h3 class="text-xl font-bold mb-4">الفرق المضافة</h3>
                    <div id="teams-list" class="space-y-2">
                        <!-- Added teams will be displayed here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const API_URL = 'https://api.npoint.io/085b34b3a65fed878377';
        const addMatchForm = document.getElementById('add-match-form');
        const addTeamForm = document.getElementById('add-team-form');
        const addLeagueForm = document.getElementById('add-league-form');
        const team1Select = document.getElementById('team1');
        const team2Select = document.getElementById('team2');
        const leagueSelects = document.querySelectorAll('#league, #team-league');
        const leagueFilter = document.getElementById('league');
        const matchesList = document.getElementById('matches-list');
        const teamsList = document.getElementById('teams-list');
        const leaguesList = document.getElementById('leagues-list');

        let allData = { leagues: [], teams: [], matches: [] };

        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    // Initialize empty data if the URL returns 404
                    if (response.status === 404) {
                        allData = { leagues: [], teams: [], matches: [] };
                        await updateData();
                    } else {
                        throw new Error('Failed to fetch data');
                    }
                } else {
                    allData = await response.json();
                }
                if (!allData.leagues) allData.leagues = [];
                if (!allData.teams) allData.teams = [];
                if (!allData.matches) allData.matches = [];
                renderLeagues();
                updateLeagueSelects();
                updateTeamFilters();
                renderTeams();
                renderMatches();
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('فشل في تحميل البيانات. يرجى التأكد من أن رابط npoint.io صحيح.');
            }
        }

        async function updateData() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(allData),
                });
                if (!response.ok) throw new Error('Failed to update data');
                return true;
            } catch (error) {
                console.error('Error updating data:', error);
                alert('فشل في تحديث البيانات. قد تكون المشكلة في الاتصال بـ npoint.io.');
                return false;
            }
        }

        function renderLeagues() {
            leaguesList.innerHTML = '';
            allData.leagues.forEach((league, index) => {
                const leagueItem = document.createElement('div');
                leagueItem.className = 'league-list-item';
                leagueItem.innerHTML = `
                    <span>${league}</span>
                    <div class="flex gap-2">
                        <button class="btn btn-yellow w-auto px-4 py-2" data-index="${index}" onclick="editLeague(this)">تعديل</button>
                        <button class="btn btn-red w-auto px-4 py-2" data-index="${index}" onclick="deleteLeague(this)">حذف</button>
                    </div>
                `;
                leaguesList.appendChild(leagueItem);
            });
        }
        
        function updateLeagueSelects() {
            leagueSelects.forEach(select => {
                select.innerHTML = allData.leagues.map(league => `<option value="${league}">${league}</option>`).join('');
            });
        }

        function updateTeamFilters() {
            const selectedLeague = leagueFilter.value;
            const teamsInLeague = allData.teams.filter(team => team.league === selectedLeague);

            team1Select.innerHTML = teamsInLeague.map(team => `<option value="${team.name}">${team.name}</option>`).join('');
            team2Select.innerHTML = teamsInLeague.map(team => `<option value="${team.name}">${team.name}</option>`).join('');
        }
        
        function renderTeams() {
            teamsList.innerHTML = '';
            allData.teams.forEach((team, index) => {
                const teamItem = document.createElement('div');
                teamItem.className = 'team-list-item';
                teamItem.innerHTML = `
                    <div class="flex items-center gap-2">
                        <img src="${team.logo}" alt="${team.name}" class="w-8 h-8 rounded-full">
                        <span>${team.name} (${team.league})</span>
                    </div>
                    <button class="btn btn-red w-auto px-4 py-2" data-index="${index}" onclick="deleteTeam(this)">حذف</button>
                `;
                teamsList.appendChild(teamItem);
            });
        }

        function renderMatches() {
            matchesList.innerHTML = '';
            allData.matches.forEach((match, index) => {
                const matchItem = document.createElement('div');
                matchItem.className = 'match-list-item';
                let matchInfo = '';
                if (match.status === 'finished') {
                    matchInfo = `${match.team1} ${match.score1} - ${match.score2} ${match.team2} (${match.league})`;
                } else {
                    matchInfo = `${match.team1} vs ${match.team2} - ${match.date} ${match.time} (${match.league})`;
                }
                matchItem.innerHTML = `
                    <span>${matchInfo}</span>
                    <div class="flex gap-2">
                        <button class="btn btn-yellow w-auto px-4 py-2" data-index="${index}" onclick="editMatch(this)">تعديل</button>
                        <button class="btn btn-red w-auto px-4 py-2" data-index="${index}" onclick="deleteMatch(this)">حذف</button>
                    </div>
                `;
                matchesList.appendChild(matchItem);
            });
        }

        async function editLeague(button) {
            const index = button.getAttribute('data-index');
            const newName = prompt('أدخل الاسم الجديد للدوري:', allData.leagues[index]);
            if (newName && newName !== allData.leagues[index]) {
                const oldName = allData.leagues[index];
                allData.leagues[index] = newName;
                
                // Update teams and matches with the new league name
                allData.teams.forEach(team => {
                    if (team.league === oldName) {
                        team.league = newName;
                    }
                });
                allData.matches.forEach(match => {
                    if (match.league === oldName) {
                        match.league = newName;
                    }
                });

                const success = await updateData();
                if (success) {
                    alert('تم تعديل اسم الدوري بنجاح.');
                    renderLeagues();
                    updateLeagueSelects();
                    renderTeams();
                    renderMatches();
                } else {
                    alert('فشل في تعديل الدوري.');
                }
            }
        }

        async function deleteLeague(button) {
            const index = button.getAttribute('data-index');
            const leagueToDelete = allData.leagues[index];
            if (confirm(`هل أنت متأكد أنك تريد حذف الدوري "${leagueToDelete}"؟ هذا سيحذف أيضًا جميع الفرق والمباريات التابعة له.`)) {
                allData.leagues.splice(index, 1);
                allData.teams = allData.teams.filter(team => team.league !== leagueToDelete);
                allData.matches = allData.matches.filter(match => match.league !== leagueToDelete);
                const success = await updateData();
                if (success) {
                    alert('تم حذف الدوري بنجاح.');
                    renderLeagues();
                    updateLeagueSelects();
                    renderTeams();
                    renderMatches();
                } else {
                    alert('فشل في حذف الدوري.');
                }
            }
        }

        async function deleteTeam(button) {
            const index = button.getAttribute('data-index');
            allData.teams.splice(index, 1);
            const success = await updateData();
            if (success) {
                alert('تم حذف الفريق بنجاح.');
                renderTeams();
                updateTeamFilters();
            } else {
                alert('فشل في حذف الفريق.');
            }
        }

        async function deleteMatch(button) {
            const index = button.getAttribute('data-index');
            allData.matches.splice(index, 1);
            const success = await updateData();
            if (success) {
                alert('تم حذف المباراة بنجاح.');
                renderMatches();
            } else {
                alert('فشل في حذف المباراة.');
            }
        }

        function editMatch(button) {
            const index = button.getAttribute('data-index');
            const matchToEdit = allData.matches[index];

            const newScore1 = prompt(`أدخل نتيجة الفريق الأول (${matchToEdit.team1}):`, matchToEdit.score1);
            const newScore2 = prompt(`أدخل نتيجة الفريق الثاني (${matchToEdit.team2}):`, matchToEdit.score2);
            
            if (newScore1 !== null && newScore2 !== null) {
                matchToEdit.score1 = parseInt(newScore1);
                matchToEdit.score2 = parseInt(newScore2);
                updateData();
                renderMatches();
            }
        }

        document.getElementsByName('match-type').forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'finished') {
                    document.getElementById('score-fields').classList.remove('hidden');
                    document.getElementById('date-time-fields').classList.add('hidden');
                } else {
                    document.getElementById('score-fields').classList.add('hidden');
                    document.getElementById('date-time-fields').classList.remove('hidden');
                }
            });
        });

        leagueFilter.addEventListener('change', updateTeamFilters);

        addLeagueForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const leagueName = document.getElementById('league-name').value;
            if (leagueName && !allData.leagues.includes(leagueName)) {
                allData.leagues.push(leagueName);
                const success = await updateData();
                if (success) {
                    alert('تم إضافة الدوري بنجاح.');
                    addLeagueForm.reset();
                    renderLeagues();
                    updateLeagueSelects();
                } else {
                    alert('فشل في إضافة الدوري.');
                }
            } else {
                alert('الدوري موجود بالفعل أو الاسم فارغ.');
            }
        });

        addMatchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const matchType = document.querySelector('input[name="match-type"]:checked').value;
            const newMatch = {
                team1: document.getElementById('team1').value,
                team2: document.getElementById('team2').value,
                league: document.getElementById('league').value,
                round: document.getElementById('round').value,
                status: matchType,
            };

            if (matchType === 'finished') {
                newMatch.score1 = parseInt(document.getElementById('score1').value);
                newMatch.score2 = parseInt(document.getElementById('score2').value);
            } else {
                newMatch.date = document.getElementById('date').value;
                newMatch.time = document.getElementById('time').value;
            }

            allData.matches.push(newMatch);
            const success = await updateData();
            if (success) {
                alert('تم إضافة المباراة بنجاح.');
                addMatchForm.reset();
                renderMatches();
            } else {
                alert('فشل في إضافة المباراة.');
            }
        });

        addTeamForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newTeam = {
                name: document.getElementById('team-name').value,
                logo: document.getElementById('team-logo').value,
                league: document.getElementById('team-league').value,
            };

            const response = await fetch(API_URL);
            const existingData = await response.json();
            
            if (existingData && existingData.teams) {
                existingData.teams.push(newTeam);
                allData.teams = existingData.teams;
            } else {
                allData.teams.push(newTeam);
            }

            const success = await updateData();
            if (success) {
                alert('تم إضافة الفريق بنجاح.');
                addTeamForm.reset();
                updateTeamFilters();
                renderTeams();
            } else {
                alert('فشل في إضافة الفريق.');
            }
        });

        window.onload = fetchData;
    </script>
</body>
</html>
