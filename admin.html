<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم AYMEN FOOT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0d1117;
            color: #ffffff;
        }
        .text-green-500 {
            color: #2ecc71;
        }
        .bg-card {
            background-color: #1a202c;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .input-field {
            background-color: #2d3748;
            color: #ffffff;
            border: 1px solid #4a5568;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }
        .btn {
            background-color: #2ecc71;
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #27ae60;
        }
        .match-type-select {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="p-6 md:p-12">

    <header class="flex items-center justify-between mb-12">
        <h1 class="text-3xl font-bold text-green-500">لوحة تحكم AYMEN FOOT</h1>
        <a href="index.html" class="btn text-sm">العودة للرئيسية</a>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-2 gap-10">
        <!-- Manage Matches Section -->
        <section class="bg-card p-8 rounded-2xl border border-gray-700">
            <h2 class="text-2xl font-bold mb-6">إدارة المباريات</h2>
            <form id="add-match-form" class="space-y-4">
                <div class="match-type-select">
                    <label class="inline-flex items-center">
                        <input type="radio" class="form-radio text-green-500" name="match-type" value="finished" checked>
                        <span class="ml-2 mr-2">مباراة منتهية</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" class="form-radio text-green-500" name="match-type" value="upcoming">
                        <span class="ml-2 mr-2">مباراة قادمة</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" class="form-radio text-green-500" name="match-type" value="postponed">
                        <span class="ml-2 mr-2">مؤجلة</span>
                    </label>
                </div>
                <div>
                    <label for="league" class="block text-sm font-medium mb-1">الدوري:</label>
                    <select id="league" class="input-field w-full" required>
                        <!-- Leagues will be dynamically added here -->
                    </select>
                </div>
                <div>
                    <label for="team1" class="block text-sm font-medium mb-1">الفريق الأول:</label>
                    <select id="team1" class="input-field w-full" required>
                        <!-- Teams will be dynamically added here -->
                    </select>
                </div>
                <div>
                    <label for="team2" class="block text-sm font-medium mb-1">الفريق الثاني:</label>
                    <select id="team2" class="input-field w-full" required>
                        <!-- Teams will be dynamically added here -->
                    </select>
                </div>
                <div id="score-fields">
                    <div>
                        <label for="score1" class="block text-sm font-medium mb-1">نتيجة الفريق الأول:</label>
                        <input type="number" id="score1" class="input-field w-full">
                    </div>
                    <div>
                        <label for="score2" class="block text-sm font-medium mb-1">نتيجة الفريق الثاني:</label>
                        <input type="number" id="score2" class="input-field w-full">
                    </div>
                </div>
                <div id="date-time-fields" class="hidden">
                    <div>
                        <label for="date" class="block text-sm font-medium mb-1">التاريخ:</label>
                        <input type="date" id="date" class="input-field w-full">
                    </div>
                    <div>
                        <label for="time" class="block text-sm font-medium mb-1">الوقت:</label>
                        <input type="time" id="time" class="input-field w-full">
                    </div>
                </div>
                <div id="round-fields">
                    <label for="round" class="block text-sm font-medium mb-1">الجولة:</label>
                    <input type="text" id="round" class="input-field w-full" required>
                </div>
                <button type="submit" class="btn w-full">إضافة مباراة</button>
            </form>

            <div id="matches-list" class="mt-8 space-y-4">
                <h3 class="text-xl font-bold mb-4">المباريات الموجودة</h3>
                <!-- Matches will be displayed here -->
            </div>
        </section>

        <!-- Manage Teams Section -->
        <section class="bg-card p-8 rounded-2xl border border-gray-700">
            <h2 class="text-2xl font-bold mb-6">إدارة الفرق</h2>
            <form id="add-team-form" class="space-y-4">
                <div>
                    <label for="team-league" class="block text-sm font-medium mb-1">الدوري:</label>
                    <select id="team-league" class="input-field w-full" required>
                        <!-- Leagues will be dynamically added here -->
                    </select>
                </div>
                <div>
                    <label for="team-name" class="block text-sm font-medium mb-1">اسم الفريق:</label>
                    <input type="text" id="team-name" class="input-field w-full" required>
                </div>
                <div>
                    <label for="team-logo" class="block text-sm font-medium mb-1">رابط الشعار:</label>
                    <input type="url" id="team-logo" class="input-field w-full" required>
                </div>
                <button type="submit" class="btn w-full">إضافة فريق</button>
            </form>
            <div id="teams-list" class="mt-8 space-y-4">
                <h3 class="text-xl font-bold mb-4">الفرق الموجودة</h3>
                <!-- Teams will be displayed here -->
            </div>
        </section>
    </main>

    <script>
        const API_URL = 'https://api.npoint.io/085b34b3a65fed878377';
        const addMatchForm = document.getElementById('add-match-form');
        const addTeamForm = document.getElementById('add-team-form');
        const leagueSelects = document.querySelectorAll('#league, #team-league');
        const team1Select = document.getElementById('team1');
        const team2Select = document.getElementById('team2');
        const matchTypeRadios = document.getElementsByName('match-type');
        const scoreFields = document.getElementById('score-fields');
        const dateTimeFields = document.getElementById('date-time-fields');
        const roundFields = document.getElementById('round-fields');
        const teamsList = document.getElementById('teams-list');
        const matchesList = document.getElementById('matches-list');

        let allData = { leagues: [], teams: [], matches: [] };
        let editingMatchId = null;

        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                if (response.ok) {
                    allData = await response.json();
                } else {
                    allData = { leagues: [], teams: [], matches: [] };
                }
            } catch (error) {
                console.error('Error fetching data:', error);
            }
            if (!allData.leagues) allData.leagues = [];
            if (!allData.teams) allData.teams = [];
            if (!allData.matches) allData.matches = [];
            
            updateLeagueSelects();
            updateTeamFilters();
            renderTeamsList();
            renderMatchesList();
        }

        async function updateData(data) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });
                if (!response.ok) throw new Error('Failed to update data');
                await fetchData();
                alert('تم تحديث البيانات بنجاح.');
            } catch (error) {
                console.error('Error updating data:', error);
                alert('فشل في تحديث البيانات. يرجى التأكد من أن رابط npoint.io صحيح.');
            }
        }

        function updateLeagueSelects() {
            const leagues = allData.leagues;
            leagueSelects.forEach(select => {
                select.innerHTML = '';
                if (leagues.length === 0) {
                    select.innerHTML = '<option value="">لا توجد دوريات</option>';
                    return;
                }
                leagues.forEach(league => {
                    const option = document.createElement('option');
                    option.value = league;
                    option.textContent = league;
                    select.appendChild(option);
                });
            });
        }
        
        function updateTeamFilters() {
            const selectedLeague = document.getElementById('league').value;
            const teamsInLeague = allData.teams.filter(team => team && team.league === selectedLeague);

            team1Select.innerHTML = '';
            team2Select.innerHTML = '';

            teamsInLeague.forEach(team => {
                const option1 = document.createElement('option');
                option1.value = team.name;
                option1.textContent = team.name;
                team1Select.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = team.name;
                option2.textContent = team.name;
                team2Select.appendChild(option2);
            });
        }

        function renderTeamsList() {
            teamsList.innerHTML = '';
            allData.teams.forEach(team => {
                const teamDiv = document.createElement('div');
                teamDiv.className = 'bg-gray-800 p-4 rounded-lg flex justify-between items-center';
                teamDiv.innerHTML = `
                    <div class="flex items-center gap-2">
                        <img src="${team.logo}" alt="${team.name}" class="w-8 h-8 rounded-full">
                        <span class="font-bold">${team.name}</span>
                    </div>
                    <button data-team-name="${team.name}" class="text-red-500 hover:text-red-700">حذف</button>
                `;
                teamsList.appendChild(teamDiv);
            });
        }

        function renderMatchesList() {
            matchesList.innerHTML = '<h3 class="text-xl font-bold mb-4">المباريات الموجودة</h3>';
            allData.matches.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'bg-gray-800 p-4 rounded-lg flex justify-between items-center';
                let matchInfo = '';
                if (match.status === 'finished') {
                    matchInfo = `${match.team1} ${match.score1} - ${match.score2} ${match.team2}`;
                } else if (match.status === 'upcoming') {
                    matchInfo = `${match.team1} vs ${match.team2} (${match.date} ${match.time})`;
                } else {
                    matchInfo = `${match.team1} vs ${match.team2} (مؤجلة)`;
                }
                matchDiv.innerHTML = `
                    <div>
                        <span class="font-bold">${matchInfo}</span>
                        <br>
                        <span class="text-gray-400 text-sm">${match.league} - الجولة ${match.round}</span>
                    </div>
                    <div class="flex gap-2">
                        <button data-match-id="${match.id}" class="edit-btn text-blue-500 hover:text-blue-700">تعديل</button>
                        <button data-match-id="${match.id}" class="delete-btn text-red-500 hover:text-red-700">حذف</button>
                    </div>
                `;
                matchesList.appendChild(matchDiv);
            });
        }

        matchTypeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'finished') {
                    scoreFields.classList.remove('hidden');
                    dateTimeFields.classList.add('hidden');
                } else if (e.target.value === 'upcoming') {
                    scoreFields.classList.add('hidden');
                    dateTimeFields.classList.remove('hidden');
                } else { // postponed
                    scoreFields.classList.add('hidden');
                    dateTimeFields.classList.add('hidden');
                }
            });
        });

        addMatchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const matchType = document.querySelector('input[name="match-type"]:checked').value;
            const newMatch = {
                id: editingMatchId || Date.now(),
                team1: document.getElementById('team1').value,
                team2: document.getElementById('team2').value,
                league: document.getElementById('league').value,
                round: document.getElementById('round').value,
                status: matchType,
            };

            if (matchType === 'finished') {
                newMatch.score1 = parseInt(document.getElementById('score1').value);
                newMatch.score2 = parseInt(document.getElementById('score2').value);
            } else if (matchType === 'upcoming') {
                newMatch.date = document.getElementById('date').value;
                newMatch.time = document.getElementById('time').value;
            }

            if (editingMatchId) {
                const index = allData.matches.findIndex(m => m.id === editingMatchId);
                if (index !== -1) {
                    allData.matches[index] = newMatch;
                }
            } else {
                allData.matches.push(newMatch);
            }

            await updateData(allData);
            addMatchForm.reset();
            editingMatchId = null;
        });

        addTeamForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newTeam = {
                name: document.getElementById('team-name').value,
                logo: document.getElementById('team-logo').value,
                league: document.getElementById('team-league').value,
            };
            allData.teams.push(newTeam);
            await updateData(allData);
            addTeamForm.reset();
            renderTeamsList();
        });

        teamsList.addEventListener('click', async (e) => {
            if (e.target.tagName === 'BUTTON' && e.target.dataset.teamName) {
                const teamName = e.target.dataset.teamName;
                allData.teams = allData.teams.filter(team => team.name !== teamName);
                await updateData(allData);
            }
        });

        matchesList.addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-btn')) {
                const matchId = parseInt(e.target.dataset.matchId);
                allData.matches = allData.matches.filter(m => m.id !== matchId);
                await updateData(allData);
            } else if (e.target.classList.contains('edit-btn')) {
                const matchId = parseInt(e.target.dataset.matchId);
                const matchToEdit = allData.matches.find(m => m.id === matchId);
                
                document.getElementById('league').value = matchToEdit.league;
                updateTeamFilters();
                document.getElementById('team1').value = matchToEdit.team1;
                document.getElementById('team2').value = matchToEdit.team2;
                document.getElementById('round').value = matchToEdit.round;

                document.querySelector(`input[name="match-type"][value="${matchToEdit.status}"]`).checked = true;
                if (matchToEdit.status === 'finished') {
                    scoreFields.classList.remove('hidden');
                    dateTimeFields.classList.add('hidden');
                    document.getElementById('score1').value = matchToEdit.score1;
                    document.getElementById('score2').value = matchToEdit.score2;
                } else if (matchToEdit.status === 'upcoming') {
                    scoreFields.classList.add('hidden');
                    dateTimeFields.classList.remove('hidden');
                    document.getElementById('date').value = matchToEdit.date;
                    document.getElementById('time').value = matchToEdit.time;
                } else {
                    scoreFields.classList.add('hidden');
                    dateTimeFields.classList.add('hidden');
                }
                editingMatchId = matchId;
            }
        });

        document.getElementById('league').addEventListener('change', updateTeamFilters);

        fetchData();
    </script>
</body>
</html>
