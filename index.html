<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aymen Foot | عالم كرة القدم بين يديك</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@700&display=swap" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚽</text></svg>">
    <style>
        :root {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --bg-card: #2d3748;
            --border-color: #4a5568;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --accent-gold: #D4AF37;
            --header-green: #15803d;
            --header-blue: #0369a1;
            --banner-red: #b91c1c;
        }

        html.light {
            --bg-primary: transparent; /* Removed solid background for transparency */
            --bg-secondary: rgba(255, 255, 255, 0.5); /* Semi-transparent secondary */
            --bg-card: rgba(255, 255, 255, 0.75); /* Semi-transparent cards */
            --border-color: rgba(0, 0, 0, 0.1);
            --text-primary: #111827;
            --text-secondary: #374151;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            /* Combined background properties with SVG watermark for DARK mode */
            background:
                url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='600' height='400' viewBox='0 0 600 400'%3e%3ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Reem Kufi, sans-serif' font-size='80' font-weight='bold' fill='rgba(255, 255, 255, 0.05)' transform='rotate(-20 300 200)'%3eAYMEN FOOT%3c/text%3e%3c/svg%3e") center center / 80% auto no-repeat,
                linear-gradient(rgba(26, 32, 44, 0.9), rgba(26, 32, 44, 0.95)),
                url('https://images.unsplash.com/photo-1508098682722-e99c43a406b2?q=80&w=2070&auto=format&fit=crop') center center / cover no-repeat;
            background-attachment: fixed;
        }
        
        html.light body {
             /* Background for LIGHT mode with a light overlay for readability */
             background:
                url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='600' height='400' viewBox='0 0 600 400'%3e%3ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Reem Kufi, sans-serif' font-size='80' font-weight='bold' fill='rgba(0, 0, 0, 0.04)' transform='rotate(-20 300 200)'%3eAYMEN FOOT%3c/text%3e%3c/svg%3e") center center / 80% auto no-repeat,
                linear-gradient(rgba(243, 244, 246, 0.85), rgba(243, 244, 246, 0.9)), /* Light overlay for readability */
                url('https://images.unsplash.com/photo-1508098682722-e99c43a406b2?q=80&w=2070&auto=format&fit=crop') center center / cover no-repeat;
            background-attachment: fixed;
        }

        .header-bg {
            background-color: rgba(26, 32, 44, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
        }

        html.light .header-bg {
            background-color: rgba(255, 255, 255, 0.7);
        }

        .news-ticker-container {
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
        }

        .logo-font {
            font-family: 'Reem Kufi', sans-serif;
            text-shadow: 1px 1px 5px rgba(212, 175, 55, 0.6);
        }
        
        html.light .logo-font {
            color: var(--text-primary);
            text-shadow: none;
        }

        .control-panel-section {
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid var(--text-primary);
            border-bottom-color: var(--accent-gold);
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .section-container {
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid var(--border-color);
            background-color: var(--bg-card);
            backdrop-filter: blur(5px);
        }

        .section-header {
            background-color: var(--header-green);
            color: white;
            font-weight: bold;
            padding: 0.75rem;
            text-align: center;
            font-size: 1.25rem;
        }
        
        .section-header-controls {
            display: flex;
            justify-content: center;
            padding: 0.5rem;
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .styled-table {
            width: 100%;
            text-align: center;
        }

        .styled-table thead th {
            background-color: var(--header-blue);
            color: white;
            padding: 0.75rem 0.5rem;
        }

        .styled-table tbody td {
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .styled-table tbody tr:last-child td {
            border-bottom: none;
        }

        .styled-table tbody tr:nth-child(even) {
            background-color: rgba(74, 85, 104, 0.2);
        }

        html.light .styled-table tbody tr:nth-child(even) {
            background-color: rgba(0,0,0,0.03); /* Semi-transparent for even rows in light mode */
        }
        
        .results-banner {
            background-color: var(--banner-red);
            color: white;
            text-align: center;
            padding: 0.75rem;
            font-weight: bold;
        }
    </style>
</head>
<body class="transition-colors duration-300">

    <!-- Admin Banner -->
    <div id="admin-banner" class="hidden bg-yellow-500 text-black text-center font-bold p-2 transition-all flex justify-center items-center gap-4">
        <span id="admin-message" class="cursor-pointer" title="اضغط للخروج من وضع الأدمن">وضع الأدمن مفعل</span>
        <button id="open-control-panel-btn" class="bg-black bg-opacity-20 hover:bg-opacity-30 text-white font-bold py-1 px-3 rounded">لوحة التحكم</button>
    </div>

    <!-- Header -->
    <header class="header-bg sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <nav class="flex items-center justify-between h-20">
                <a href="#" id="logo-link" class="flex items-center space-x-3 rtl:space-x-reverse">
                    <span class="text-3xl font-bold logo-font">Aymen Foot</span>
                </a>
                <div class="hidden lg:flex items-center space-x-6 rtl:space-x-reverse text-lg">
                    <a href="#schedule" class="hover:text-yellow-400 transition-colors">الرزنامة</a>
                    <a href="#standings" class="hover:text-yellow-400 transition-colors">الترتيب</a>
                    <a href="#results" class="hover:text-yellow-400 transition-colors">النتائج</a>
                    <a href="#news" class="hover:text-yellow-400 transition-colors">الأخبار</a>
                </div>
                <div class="flex items-center space-x-2">
                     <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-700">
                        <svg id="theme-icon-sun" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.706-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 10.607a1 1 0 011.414 0l.707-.707a1 1 0 111.414 1.414l-.707.707a1 1 0 01-1.414 0zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                        <svg id="theme-icon-moon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    </button>
                    <a href="#schedule" class="hidden sm:inline-block bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-5 rounded-full shadow-lg transition-transform transform hover:scale-105 duration-300">
                        تابع مباشرة
                    </a>
                </div>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8 space-y-12">

        <!-- Schedule Section -->
        <section id="schedule">
            <div class="section-container">
                <div id="schedule-title" class="section-header">الرزنامة</div>
                <div class="section-header-controls">
                    <select id="schedule-round-selector" class="appearance-none bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 pr-8 text-white focus:outline-none focus:border-yellow-500"></select>
                </div>
                <div class="overflow-x-auto">
                    <table class="styled-table">
                        <tbody id="schedule-tbody">
                            <tr><td><div class="loader mx-auto my-4"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Standings Section -->
        <section id="standings">
            <div class="section-container">
                <div class="section-header">الترتيب</div>
                <div class="section-header-controls">
                    <select id="league-selector" class="appearance-none bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 pr-8 text-white focus:outline-none focus:border-yellow-500"></select>
                </div>
                <div class="overflow-x-auto">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>الترتيب</th>
                                <th class="text-right px-4">الفرق</th>
                                <th>لعب</th>
                                <th>النقاط</th>
                            </tr>
                        </thead>
                        <tbody id="standings-tbody">
                            <tr><td colspan="4" class="text-center py-8"><div class="loader mx-auto"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results">
            <div class="section-container">
                <div id="results-title" class="section-header">النتائج</div>
                <div class="section-header-controls">
                    <select id="results-round-selector" class="appearance-none bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 pr-8 text-white focus:outline-none focus:border-yellow-500"></select>
                </div>
                <div id="results-content" class="overflow-x-auto">
                     <div class="p-4"><div class="loader mx-auto"></div></div>
                </div>
            </div>
        </section>

    </main>

    <!-- News Ticker -->
    <div id="news" class="news-ticker-container fixed bottom-0 left-0 w-full z-40">
        <div class="container mx-auto flex items-center h-12">
            <span class="bg-red-600 text-white font-bold text-sm px-3 py-1 rounded-md ml-4">عاجل</span>
            <div id="news-ticker-content" class="overflow-hidden flex-1">
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 mt-12 pt-20 pb-8">
        <div class="container mx-auto text-center text-gray-400">
             <div class="flex justify-center space-x-6 rtl:space-x-reverse mb-6">
                <a href="#" class="hover:text-yellow-400">Facebook</a>
                <a href="#" class="hover:text-yellow-400">Twitter</a>
                <a href="#" class="hover:text-yellow-400">Instagram</a>
            </div>
            <p id="copyright-notice" class="cursor-pointer" title="Admin Login">جميع الحقوق محفوظة &copy; 2025 Aymen Foot</p>
            <a href="#" class="hover:text-yellow-400">اتصل بنا</a>
        </div>
    </footer>
    
    <!-- Modals -->
     <div id="admin-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[110]">
        <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-sm">
            <h3 class="text-2xl font-bold text-white mb-4 text-center">دخول الأدمن</h3>
            <div class="space-y-4">
                <input type="password" id="admin-password-input" class="w-full bg-gray-700 text-white rounded-md p-3 border border-gray-600" placeholder="••••••••">
                <p id="modal-error-msg" class="text-red-500 text-sm text-center hidden">كلمة مرور خاطئة!</p>
                <button id="admin-submit-btn" class="w-full bg-yellow-500 text-black font-bold py-3 rounded-md">دخول</button>
                <button id="admin-cancel-btn" class="w-full bg-gray-600 text-white font-bold py-3 rounded-md">إلغاء</button>
            </div>
        </div>
    </div>

    <div id="control-panel-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[100] p-4">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-4xl max-h-full overflow-y-auto">
            <h2 class="text-2xl font-bold text-white mb-4">لوحة التحكم</h2>
            <div class="control-panel-section">
                 <h3 class="text-lg font-semibold mb-2">إدارة الدوريات والفرق</h3>
                 <div class="flex items-center gap-2 mb-4">
                    <select id="admin-league-selector" class="w-full bg-gray-700 text-white rounded p-2 border border-gray-600"></select>
                    <button id="admin-add-league-btn" class="bg-blue-500 p-2 rounded" title="إضافة دوري">➕</button>
                    <button id="admin-delete-league-btn" class="bg-red-500 p-2 rounded" title="حذف الدوري">🗑️</button>
                </div>
                 <div id="admin-teams-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                 <button id="admin-add-team-btn" class="w-full mt-2 bg-green-600 text-white p-2 rounded">إضافة فريق جديد</button>
            </div>
            <div class="control-panel-section">
                <h3 class="text-lg font-semibold mb-2">إدارة الجولات والمباريات</h3>
                <div class="flex items-center gap-2 mb-4">
                    <select id="admin-round-selector" class="w-full bg-gray-700 text-white rounded p-2 border border-gray-600"></select>
                    <button id="set-upcoming-round-btn" class="bg-yellow-600 text-white p-2 rounded text-sm whitespace-nowrap">تعيين كجولة قادمة</button>
                    <button id="set-results-round-btn" class="bg-green-700 text-white p-2 rounded text-sm whitespace-nowrap">تعيين كجولة نتائج</button>
                    <button id="admin-add-round-btn" class="bg-blue-500 p-2 rounded" title="إضافة جولة جديدة">➕</button>
                </div>
                <div id="admin-matches-list" class="space-y-2 mb-4 max-h-48 overflow-y-auto"></div>
                <div id="admin-add-match-form" class="flex flex-wrap gap-2 items-end">
                    <select id="admin-team1-select" class="flex-grow bg-gray-700 text-white rounded p-2 border border-gray-600"></select>
                    <span class="font-bold">vs</span>
                    <select id="admin-team2-select" class="flex-grow bg-gray-700 text-white rounded p-2 border border-gray-600"></select>
                    <input type="text" id="admin-match-time" class="w-20 bg-gray-700 text-white rounded p-2 border border-gray-600" value="00:00">
                    <input type="text" id="admin-match-date" class="w-28 bg-gray-700 text-white rounded p-2 border border-gray-600" placeholder="التاريخ">
                    <button id="admin-add-match-btn" class="bg-green-600 text-white p-2 rounded">إضافة</button>
                </div>
            </div>
            <div class="control-panel-section">
                 <h3 class="text-lg font-semibold mb-2">إدارة الأخبار</h3>
                 <div id="admin-news-list" class="space-y-2 mb-4 max-h-40 overflow-y-auto"></div>
                 <div class="flex gap-2">
                     <input type="text" id="admin-news-input" class="w-full bg-gray-700 text-white rounded p-2 border border-gray-600" placeholder="اكتب الخبر...">
                     <button id="admin-add-news-btn" class="bg-green-600 text-white p-2 rounded">إضافة</button>
                 </div>
            </div>
            <button id="close-control-panel-btn" class="w-full mt-4 bg-gray-600 text-white p-2 rounded">إغلاق</button>
        </div>
    </div>
    <div id="generic-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[120] p-4">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-sm text-center">
            <p id="generic-modal-message" class="text-white mb-4"></p>
            <div id="generic-modal-buttons" class="flex justify-center gap-4">
                 <button id="generic-modal-ok-btn" class="bg-yellow-500 text-black font-bold py-2 px-6 rounded">موافق</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        let isAdmin = false;
        let data = {};
        let db;
        let auth;
        let dbDocRef;
        let selectedLeagueName = '';
        let selectedMatchesRound = '';
        let selectedResultsRound = '';

        const ADMIN_PASSWORD = "200411";
        
        async function saveData() {
            if (!dbDocRef || !isAdmin) return;
            try {
                await setDoc(dbDocRef, data, { merge: true });
            } catch (e) { console.error("Error saving data: ", e); }
        }

        function setupRealtimeListener() {
            onSnapshot(dbDocRef, (doc) => {
                if (doc.exists()) {
                    data = doc.data();
                    if (!data.leagues) data.leagues = [];
                    if (!data.news) data.news = [];
                } else {
                    data = { leagues: [{ name: "الدوري الافتراضي", currentRound: '1', lastResultsRound: '1', teams: [], schedule: {'1': []} }], news: ["مرحباً بك في موقع Aymen Foot الرياضي!"] };
                }
                
                if (!selectedLeagueName && data.leagues && data.leagues.length > 0) {
                    selectedLeagueName = data.leagues[0].name;
                }

                renderAll();

                if (isAdmin && !document.getElementById('control-panel-modal').classList.contains('hidden')) {
                    renderControlPanel();
                }
            }, (error) => {
                console.error("Error with real-time listener:", error);
                showCustomAlert("فشل الاتصال بالبيانات.");
            });
        }
        
        function getLeague(leagueName) {
            return data.leagues.find(l => l.name === leagueName);
        }

        function calculateStandings(leagueName) {
            const league = getLeague(leagueName);
            if (!league || !league.teams) return [];
            league.teams.forEach(t => { t.p=0; t.w=0; t.d=0; t.l=0; t.gf=0; t.ga=0; t.pts=0; });
            for (const roundNum in league.schedule) {
                league.schedule[roundNum].forEach(match => {
                    if (match.status && match.status !== 'normal') return; 
                    const s1 = parseInt(match.score1), s2 = parseInt(match.score2);
                    if (isNaN(s1) || isNaN(s2)) return;
                    const t1 = league.teams.find(t => t.name === match.team1);
                    const t2 = league.teams.find(t => t.name === match.team2);
                    if (!t1 || !t2) return;
                    t1.p++; t2.p++; t1.gf += s1; t1.ga += s2; t2.gf += s2; t2.ga += s1;
                    if (s1 > s2) { t1.w++; t1.pts += 3; t2.l++; }
                    else if (s2 > s1) { t2.w++; t2.pts += 3; t1.l++; }
                    else { t1.d++; t2.d++; t1.pts++; t2.pts++; }
                });
            }
            league.teams.sort((a, b) => b.pts - a.pts || (b.gf - b.ga) - (a.gf - a.ga) || b.gf - a.gf || a.name.localeCompare(b.name));
            return league.teams;
        }

        function renderAll() {
            renderLeaguesDropdown();
            renderSchedule();
            renderStandings();
            renderResults();
            renderNewsTicker();
        }

        function renderLeaguesDropdown() {
            const selector = document.getElementById('league-selector');
            selector.innerHTML = (data.leagues || []).map(l => `<option ${l.name === selectedLeagueName ? 'selected' : ''}>${l.name}</option>`).join('');
        }

        function renderSchedule() {
            const tbody = document.getElementById('schedule-tbody');
            const title = document.getElementById('schedule-title');
            const roundSelector = document.getElementById('schedule-round-selector');
            const league = getLeague(selectedLeagueName);

            if (!league || !league.schedule || Object.keys(league.schedule).length === 0) {
                title.textContent = "الرزنامة";
                tbody.innerHTML = `<tr><td class="text-gray-400 text-center py-4">لا توجد مباريات قادمة.</td></tr>`;
                roundSelector.innerHTML = '';
                roundSelector.classList.add('hidden');
                return;
            }
            
            roundSelector.classList.remove('hidden');
            const rounds = Object.keys(league.schedule).sort((a, b) => parseInt(a) - parseInt(b));
            if (!selectedMatchesRound || !league.schedule[selectedMatchesRound]) {
                selectedMatchesRound = league.currentRound || rounds[0];
            }
            roundSelector.innerHTML = rounds.map(r => `<option value="${r}" ${r === selectedMatchesRound ? 'selected' : ''}>الجولة ${r}</option>`).join('');
            
            const matchesForRound = league.schedule[selectedMatchesRound];
            
            title.textContent = `الرزنامة - الجولة ${selectedMatchesRound}`;
            
            if (!matchesForRound || matchesForRound.length === 0) {
                 tbody.innerHTML = `<tr><td class="text-gray-400 text-center py-4">لا توجد مباريات في هذه الجولة.</td></tr>`;
                 return;
            }

            tbody.innerHTML = matchesForRound.map(match => {
                const team1 = league.teams.find(t => t.name === match.team1);
                const team2 = league.teams.find(t => t.name === match.team2);
                
                let centerContent;
                if (match.status === 'postponed') {
                    centerContent = `<span class="font-bold text-sm text-yellow-400">مؤجلة</span>`;
                } else if (match.status === 'stopped') {
                    centerContent = `<span class="font-bold text-sm text-red-500">متوقفة</span>`;
                } else {
                    centerContent = `<span class="font-bold text-lg">${match.time || '-'}</span>`;
                }

                return `
                <tr>
                    <td class="w-2/5 text-right">
                        <div class="flex items-center justify-end gap-3 px-2 sm:px-4">
                            <span class="font-bold hidden sm:inline">${match.team1}</span>
                            <img src="${team1?.logo || 'https://placehold.co/40x40/333/FFF?text=??'}" onerror="this.src='https://placehold.co/40x40/333/FFF?text=??'" class="w-8 h-8 object-contain rounded-full">
                        </div>
                    </td>
                    <td class="w-1/5 text-center align-middle">${centerContent}</td>
                    <td class="w-2/5 text-left">
                        <div class="flex items-center justify-start gap-3 px-2 sm:px-4">
                            <img src="${team2?.logo || 'https://placehold.co/40x40/333/FFF?text=??'}" onerror="this.src='https://placehold.co/40x40/333/FFF?text=??'" class="w-8 h-8 object-contain rounded-full">
                            <span class="font-bold hidden sm:inline">${match.team2}</span>
                        </div>
                    </td>
                </tr>`;
            }).join('');
        }
        
        function renderStandings() {
            const tbody = document.getElementById('standings-tbody');
            const standings = calculateStandings(selectedLeagueName);
            if (!standings || standings.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" class="text-center py-8 text-gray-400">لا توجد فرق في هذا الدوري.</td></tr>`; return;
            }
            tbody.innerHTML = standings.map((team, index) => `
                <tr>
                    <td class="font-bold">${index + 1}</td>
                    <td class="text-right">
                        <div class="flex items-center gap-3 px-4">
                            <img src="${team.logo || 'https://placehold.co/40x40/333/FFF?text=??'}" onerror="this.src='https://placehold.co/40x40/333/FFF?text=??'" class="w-6 h-6 object-contain">
                            <span>${team.name}</span>
                        </div>
                    </td>
                    <td>${team.p}</td>
                    <td class="font-bold text-yellow-400">${team.pts}</td>
                </tr>`).join('');
        }

        function renderResults() {
            const container = document.getElementById('results-content');
            const title = document.getElementById('results-title');
            const roundSelector = document.getElementById('results-round-selector');
            const league = getLeague(selectedLeagueName);

            if (!league || !league.schedule || Object.keys(league.schedule).length === 0) {
                title.textContent = "النتائج";
                container.innerHTML = `<div class="results-banner">لا يوجد نتائج</div>`;
                roundSelector.parentElement.classList.add('hidden');
                return;
            }

            roundSelector.parentElement.classList.remove('hidden');
            const rounds = Object.keys(league.schedule).sort((a, b) => parseInt(a) - parseInt(b));
             if (!selectedResultsRound || !league.schedule[selectedResultsRound]) {
                selectedResultsRound = league.lastResultsRound || rounds[0];
            }
            roundSelector.innerHTML = rounds.map(r => `<option value="${r}" ${r === selectedResultsRound ? 'selected' : ''}>الجولة ${r}</option>`).join('');

            title.textContent = `النتائج - الجولة ${selectedResultsRound}`;

            const resultsForRound = league.schedule[selectedResultsRound];
            const playedMatches = resultsForRound?.filter(m => m.score1 !== null && m.score1 !== undefined && m.score1 !== '');

            if (!playedMatches || playedMatches.length === 0) {
                container.innerHTML = `<div class="results-banner">لا يوجد نتائج لهذه الجولة</div>`;
                return;
            }

            container.innerHTML = `
            <table class="styled-table">
                <tbody>
                ${playedMatches.map(result => {
                    const team1 = league.teams.find(t => t.name === result.team1);
                    const team2 = league.teams.find(t => t.name === result.team2);
                    let scoreContent;
                    if (result.status === 'postponed') {
                        scoreContent = `<span class="font-bold text-sm text-yellow-400">مؤجلة</span>`;
                    } else if (result.status === 'stopped') {
                        scoreContent = `<span class="font-bold text-sm text-red-500">متوقفة</span>`;
                    } else {
                        scoreContent = `<div class="bg-gray-900 px-3 py-1 rounded-md text-xl font-black">${result.score1 ?? '?'} - ${result.score2 ?? '?'}</div>`;
                    }

                    return `
                    <tr>
                        <td class="w-2/5 text-right">
                            <div class="flex items-center justify-end gap-3 px-2 sm:px-4">
                                <span class="font-bold hidden sm:inline">${result.team1}</span>
                                <img src="${team1?.logo || 'https://placehold.co/40x40/333/FFF?text=??'}" onerror="this.src='https://placehold.co/40x40/333/FFF?text=??'" class="w-8 h-8 object-contain rounded-full">
                            </div>
                        </td>
                        <td class="w-1/5 text-center align-middle">${scoreContent}</td>
                        <td class="w-2/5 text-left">
                            <div class="flex items-center justify-start gap-3 px-2 sm:px-4">
                                <img src="${team2?.logo || 'https://placehold.co/40x40/333/FFF?text=??'}" onerror="this.src='https://placehold.co/40x40/333/FFF?text=??'" class="w-8 h-8 object-contain rounded-full">
                                <span class="font-bold hidden sm:inline">${result.team2}</span>
                            </div>
                        </td>
                    </tr>`;
                }).join('')}
                </tbody>
            </table>`;
        }
        
        function renderNewsTicker() {
            const container = document.getElementById('news-ticker-content');
            if (!data.news || data.news.length === 0) { container.innerHTML = `<p>لا توجد أخبار حالياً.</p>`; return; }
            const newsHtml = data.news.map(item => `<span class="mx-6">${item}</span>`).join('');
            const duration = data.news.length * 10;
            container.innerHTML = `<p class="whitespace-nowrap animate-marquee">${newsHtml}</p><style>@keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } } .animate-marquee { display: inline-block; animation: marquee ${duration}s linear infinite; }</style>`;
        }
        
        function renderControlPanel() {
            const leagueSelector = document.getElementById('admin-league-selector');
            leagueSelector.innerHTML = data.leagues.map(l => `<option>${l.name}</option>`).join('');
            renderAdminPanelForLeague(leagueSelector.value);
            renderAdminNews();
        }

        function renderAdminPanelForLeague(leagueName) {
            const league = getLeague(leagueName);
            if (!league) return;
            const teamsList = document.getElementById('admin-teams-list');
            const roundSelector = document.getElementById('admin-round-selector');
            const team1Select = document.getElementById('admin-team1-select');
            const team2Select = document.getElementById('admin-team2-select');
            
            teamsList.innerHTML = league.teams.map((team, index) => `
                <div class="flex gap-2 items-center"><input type="text" value="${team.name}" onchange="app.updateTeam(${index}, 'name', this.value)" class="w-1/3 p-1 bg-gray-900 rounded"><input type="text" value="${team.logo || ''}" onchange="app.updateTeam(${index}, 'logo', this.value)" class="w-2/3 p-1 bg-gray-900 rounded" placeholder="رابط الشعار"><button onclick="app.deleteTeam(${index})" class="text-red-500 p-1 hover:bg-red-500 hover:text-white rounded-full">🗑️</button></div>`).join('');
            
            roundSelector.innerHTML = Object.keys(league.schedule || {}).map(r => `<option>${r}</option>`).join('');
            renderAdminMatchesForRound(leagueName, roundSelector.value);

            const teamOptions = league.teams.map(t => `<option>${t.name}</option>`).join('');
            team1Select.innerHTML = teamOptions;
            team2Select.innerHTML = teamOptions;
        }
        
        function renderAdminMatchesForRound(leagueName, roundNum) {
            const league = getLeague(leagueName);
            const matchesList = document.getElementById('admin-matches-list');
            if (!league || !roundNum || !league.schedule[roundNum]) { matchesList.innerHTML = ''; return; }
            matchesList.innerHTML = league.schedule[roundNum].map((match, index) => `
                <div class="flex gap-2 items-center text-sm p-2 bg-gray-900 rounded">
                    <span class="flex-1">${match.team1} vs ${match.team2}</span>
                    <select onchange="app.updateMatchStatus(${roundNum}, ${index}, this.value)" class="p-1 bg-gray-700 rounded">
                        <option value="normal" ${!match.status || match.status === 'normal' ? 'selected' : ''}>عادي</option>
                        <option value="postponed" ${match.status === 'postponed' ? 'selected' : ''}>مؤجلة</option>
                        <option value="stopped" ${match.status === 'stopped' ? 'selected' : ''}>متوقفة</option>
                    </select>
                    <input type="number" value="${match.score1 ?? ''}" onchange="app.updateScore(${roundNum}, ${index}, 'score1', this.value)" class="w-12 p-1 bg-gray-700 rounded">
                    <input type="number" value="${match.score2 ?? ''}" onchange="app.updateScore(${roundNum}, ${index}, 'score2', this.value)" class="w-12 p-1 bg-gray-700 rounded">
                    <button onclick="app.deleteMatch(${roundNum}, ${index})" class="text-red-500 p-1 hover:bg-red-500 hover:text-white rounded-full">🗑️</button>
                </div>`).join('');
        }

        function renderAdminNews() {
            const newsList = document.getElementById('admin-news-list');
            newsList.innerHTML = (data.news || []).map((item, index) => `
                <div class="flex justify-between items-center bg-gray-700 p-2 rounded"><span>${item}</span><button onclick="app.deleteNews(${index})" class="text-red-500 p-1 hover:bg-red-500 hover:text-white rounded-full">🗑️</button></div>`).join('');
        }

        function showCustomAlert(message) {
            document.getElementById('generic-modal-message').textContent = message;
            document.getElementById('generic-modal').classList.remove('hidden');
        }

        function hideCustomAlert() {
            document.getElementById('generic-modal').classList.add('hidden');
        }

        const showCustomConfirm = (message, callback) => {
            const confirmed = confirm(message);
            callback(confirmed);
        };
        const showCustomPrompt = (message, placeholder, callback) => {
            const result = prompt(message, placeholder);
            callback(result);
        };

        window.app = {
            addLeague: () => showCustomPrompt("ما هو اسم الدوري الجديد؟", "", name => { if (name && !getLeague(name)) { data.leagues.push({ name, currentRound: '1', lastResultsRound: '1', teams: [], schedule: {'1':[]} }); saveData(); } }),
            deleteLeague: () => { const name = document.getElementById('admin-league-selector').value; showCustomConfirm(`هل أنت متأكد من حذف دوري "${name}"؟`, confirmed => { if (confirmed) { data.leagues = data.leagues.filter(l => l.name !== name); saveData(); } }); },
            addTeam: () => showCustomPrompt("ما هو اسم الفريق الجديد؟", "", name => { const league = getLeague(document.getElementById('admin-league-selector').value); if (name && league && !league.teams.find(t => t.name === name)) { league.teams.push({ name: name, logo: '' }); saveData(); } }),
            updateTeam: (index, field, value) => { const league = getLeague(document.getElementById('admin-league-selector').value); const oldName = league.teams[index].name; league.teams[index][field] = value; if (field === 'name') { for (const round in league.schedule) { league.schedule[round].forEach(match => { if (match.team1 === oldName) match.team1 = value; if (match.team2 === oldName) match.team2 = value; }); } } saveData(); },
            deleteTeam: (index) => { const league = getLeague(document.getElementById('admin-league-selector').value); showCustomConfirm(`هل أنت متأكد من حذف فريق "${league.teams[index].name}"؟`, confirmed => { if(confirmed) { league.teams.splice(index, 1); saveData(); }}); },
            addRound: () => { const league = getLeague(document.getElementById('admin-league-selector').value); const maxRound = Math.max(0, ...Object.keys(league.schedule || {}).map(Number)); if (!league.schedule) league.schedule = {}; league.schedule[maxRound + 1] = []; saveData(); },
            addMatch: () => { const leagueName = document.getElementById('admin-league-selector').value, roundNum = document.getElementById('admin-round-selector').value; const league = getLeague(leagueName); const t1 = document.getElementById('admin-team1-select').value, t2 = document.getElementById('admin-team2-select').value; if (t1 === t2) { showCustomAlert("لا يمكن للفريق اللعب ضد نفسه."); return; } league.schedule[roundNum].push({ id: Date.now(), team1: t1, team2: t2, time: document.getElementById('admin-match-time').value, date: document.getElementById('admin-match-date').value, score1: null, score2: null, status: 'normal' }); saveData(); },
            deleteMatch: (round, index) => { showCustomConfirm("هل أنت متأكد من حذف هذه المباراة؟", confirmed => { if(confirmed) { getLeague(document.getElementById('admin-league-selector').value).schedule[round].splice(index, 1); saveData(); }}); },
            updateScore: (round, index, scoreField, value) => { const league = getLeague(document.getElementById('admin-league-selector').value); league.schedule[round][index][scoreField] = value; league.schedule[round][index].status = 'normal'; saveData(); },
            updateMatchStatus: (r, i, status) => { getLeague(document.getElementById('admin-league-selector').value).schedule[r][i]['status'] = status; saveData(); },
            setUpcoming: () => { const league = getLeague(document.getElementById('admin-league-selector').value); league.currentRound = document.getElementById('admin-round-selector').value; saveData(); showCustomAlert("تم تحديد الجولة القادمة بنجاح."); },
            setResults: () => { const league = getLeague(document.getElementById('admin-league-selector').value); league.lastResultsRound = document.getElementById('admin-round-selector').value; saveData(); showCustomAlert("تم تحديد جولة النتائج الأخيرة بنجاح."); },
            addNews: () => { const input = document.getElementById('admin-news-input'); if (input.value) { if (!data.news) data.news = []; data.news.unshift(input.value.trim()); input.value = ''; saveData(); } },
            deleteNews: (index) => { data.news.splice(index, 1); saveData(); }
        };

        function setAdminMode(enabled) {
            isAdmin = enabled;
            document.getElementById('admin-banner').classList.toggle('hidden', !enabled);
        }

        function showAdminModal() { 
            document.getElementById('modal-error-msg').classList.add('hidden');
            document.getElementById('admin-password-input').value = '';
            document.getElementById('admin-modal').classList.remove('hidden'); 
            document.getElementById('admin-password-input').focus(); 
        }
        function hideAdminModal() { 
            document.getElementById('admin-modal').classList.add('hidden'); 
        }
        function checkAdminPassword() {
            if (document.getElementById('admin-password-input').value === ADMIN_PASSWORD) {
                setAdminMode(true);
                hideAdminModal();
                document.getElementById('control-panel-modal').classList.remove('hidden');
                renderControlPanel();
            } else {
                document.getElementById('modal-error-msg').classList.remove('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.getElementById('theme-toggle');
            const sunIcon = document.getElementById('theme-icon-sun');
            const moonIcon = document.getElementById('theme-icon-moon');
            const updateThemeIcons = (isLight) => {
                sunIcon.classList.toggle('hidden', !isLight);
                moonIcon.classList.toggle('hidden', isLight);
            };
            themeToggle.addEventListener('click', () => {
                const isLight = document.documentElement.classList.toggle('light');
                localStorage.setItem('theme', isLight ? 'light' : 'dark');
                updateThemeIcons(isLight);
            });
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme === 'light' || (!savedTheme && !systemPrefersDark)) {
                document.documentElement.classList.add('light');
                updateThemeIcons(true);
            } else {
                 updateThemeIcons(false);
            }

            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyDfmtZppMrjm7E_MXC3gMAavtVFVm1xbtw",
                    authDomain: "jjji-b7095.firebaseapp.com",
                    databaseURL: "https://jjji-b7095-default-rtdb.firebaseio.com",
                    projectId: "jjji-b7095",
                    storageBucket: "jjji-b7095.appspot.com",
                    messagingSenderId: "301036501127",
                    appId: "1:301036501127:web:967e1e6402b23000782022",
                    measurementId: "G-B2J2VFV82B"
                };
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                dbDocRef = doc(db, "sports-app", "main-data");

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        setupRealtimeListener();
                    } else {
                        await signInAnonymously(auth);
                    }
                });
            } catch (e) {
                console.error("Firebase initialization failed:", e);
                showCustomAlert("فشل الاتصال بالخادم. يرجى تحديث الصفحة.");
            }
            
            document.getElementById('league-selector').addEventListener('change', (e) => {
                selectedLeagueName = e.target.value;
                const league = getLeague(selectedLeagueName);
                if (league) {
                    selectedMatchesRound = league.currentRound;
                    selectedResultsRound = league.lastResultsRound;
                }
                renderAll();
            });
             document.getElementById('schedule-round-selector').addEventListener('change', (e) => {
                selectedMatchesRound = e.target.value;
                renderSchedule();
            });
            document.getElementById('results-round-selector').addEventListener('change', (e) => {
                selectedResultsRound = e.target.value;
                renderResults();
            });
            
            document.getElementById('copyright-notice').addEventListener('click', showAdminModal);
            document.getElementById('admin-message').addEventListener('click', () => setAdminMode(false));
            document.getElementById('open-control-panel-btn').addEventListener('click', () => { 
                renderControlPanel(); 
                document.getElementById('control-panel-modal').classList.remove('hidden'); 
            });
            document.getElementById('close-control-panel-btn').addEventListener('click', () => document.getElementById('control-panel-modal').classList.add('hidden'));
            
            document.getElementById('admin-submit-btn').addEventListener('click', checkAdminPassword);
            document.getElementById('admin-password-input').addEventListener('keyup', e => { if (e.key === 'Enter') checkAdminPassword(); });
            document.getElementById('admin-cancel-btn').addEventListener('click', hideAdminModal);
            document.getElementById('generic-modal-ok-btn').addEventListener('click', hideCustomAlert);

            document.getElementById('admin-league-selector').addEventListener('change', (e) => renderAdminPanelForLeague(e.target.value));
            document.getElementById('admin-round-selector').addEventListener('change', (e) => renderAdminMatchesForRound(document.getElementById('admin-league-selector').value, e.target.value));
            
            document.getElementById('admin-add-league-btn').addEventListener('click', window.app.addLeague);
            document.getElementById('admin-delete-league-btn').addEventListener('click', window.app.deleteLeague);
            document.getElementById('admin-add-team-btn').addEventListener('click', window.app.addTeam);
            document.getElementById('admin-add-round-btn').addEventListener('click', window.app.addRound);
            document.getElementById('admin-add-match-btn').addEventListener('click', window.app.addMatch);
            document.getElementById('set-upcoming-round-btn').addEventListener('click', window.app.setUpcoming);
            document.getElementById('set-results-round-btn').addEventListener('click', window.app.setResults);
            document.getElementById('admin-add-news-btn').addEventListener('click', window.app.addNews);
        });
    </script>
</body>
</html>

