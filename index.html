<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aymen Foot | عالم كرة القدم بين يديك</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --bg-card: #2d3748;
            --border-color: #4a5568;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --accent-gold: #D4AF37;
            --accent-green: #38A169;
            --accent-red: #E53E3E;
            --accent-orange: #DD6B20;
        }

        html.light {
            --bg-primary: #f7fafc;
            --bg-secondary: #edf2f7;
            --bg-card: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            background-image: linear-gradient(rgba(26, 32, 44, 0.9), rgba(26, 32, 44, 0.95)), url('https://placehold.co/1920x1080/000000/FFFFFF?text=aymen+foot');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .header-bg {
            background-color: rgba(26, 32, 44, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
        }

        .news-ticker-container {
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
        }

        .logo-font {
            font-family: 'Reem Kufi', sans-serif;
            text-shadow: 1px 1px 5px rgba(212, 175, 55, 0.6);
        }
        
        .admin-input {
            background-color: #1a202c;
            color: var(--accent-gold);
            border: 1px solid var(--accent-gold);
            text-align: center;
            border-radius: 5px;
            padding: 2px;
            width: 100%;
        }
        html.light .admin-input {
             background-color: #edf2f7;
        }
        .control-panel-section {
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="transition-colors duration-300">

    <div id="admin-banner" class="hidden bg-yellow-500 text-black text-center font-bold p-2 transition-all flex justify-center items-center gap-4">
        <span id="admin-message" class="cursor-pointer"></span>
    </div>

    <!-- الشريط العلوي -->
    <header class="header-bg sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <nav class="flex items-center justify-between h-20">
                <a href="#" id="logo-link" class="flex items-center space-x-3 rtl:space-x-reverse">
                    <span class="text-3xl font-bold text-white logo-font">Aymen Foot</span>
                </a>
                <div class="hidden lg:flex items-center space-x-6 rtl:space-x-reverse text-lg">
                    <a href="#matches" class="hover:text-yellow-400 transition-colors">المباريات</a>
                    <a href="#standings" class="hover:text-yellow-400 transition-colors">الترتيب</a>
                    <a href="#results" class="hover:text-yellow-400 transition-colors">النتائج</a>
                    <a href="#news" class="hover:text-yellow-400 transition-colors">الأخبار</a>
                </div>
                <div class="flex items-center space-x-2">
                     <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-700">
                        <svg id="theme-icon-sun" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg id="theme-icon-moon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                    <a href="#" class="hidden sm:inline-block bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-5 rounded-full shadow-lg transition-transform transform hover:scale-105 duration-300">
                        تابع مباشرة
                    </a>
                </div>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <!-- قسم المباريات القادمة -->
        <section id="matches" class="mb-16">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-3xl font-bold text-white" id="upcoming-matches-title">المباريات القادمة</h2>
            </div>
            <div id="matches-container" class="grid grid-cols-1 md:grid-cols-2 gap-6 min-h-[100px]">
                <!-- بطاقات المباريات تضاف هنا -->
            </div>
        </section>

        <!-- قسم الترتيب -->
        <section id="standings" class="mb-16">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                <div class="flex items-center gap-3">
                    <h2 class="text-3xl font-bold text-white">جدول الترتيب</h2>
                </div>
                <div class="flex items-center gap-2">
                    <select id="league-selector" class="appearance-none bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 pr-8 text-white focus:outline-none focus:border-yellow-500">
                    </select>
                </div>
            </div>
            <div class="card rounded-lg shadow-xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-center">
                        <thead class="bg-gray-800 text-gray-400 uppercase text-sm">
                            <tr>
                                <th class="py-4 px-2">#</th>
                                <th class="py-4 px-4 text-right">الفريق</th>
                                <th class="py-4 px-2">ل</th>
                                <th class="py-4 px-2">ف</th>
                                <th class="py-4 px-2">ت</th>
                                <th class="py-4 px-2">خ</th>
                                <th class="py-4 px-2">له/عليه</th>
                                <th class="py-4 px-2 font-bold">نقاط</th>
                            </tr>
                        </thead>
                        <tbody id="standings-tbody" class="divide-y divide-gray-600">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- قسم النتائج الأخيرة -->
        <section id="results" class="mb-16">
            <div class="flex items-center justify-between mb-8">
                 <h2 class="text-3xl font-bold text-white" id="latest-results-title">النتائج الأخيرة</h2>
            </div>
            <div id="results-container" class="relative pr-8 border-r-3 border-gray-700 min-h-[100px]">
            </div>
        </section>

    </main>

    <!-- شريط الأخبار -->
    <div id="news" class="news-ticker-container fixed bottom-0 left-0 w-full z-40">
        <div class="container mx-auto flex items-center h-12">
            <span class="bg-red-600 text-white font-bold text-sm px-3 py-1 rounded-md ml-4">عاجل</span>
            <div id="news-ticker-content" class="overflow-hidden flex-1">
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 mt-12 pt-20 pb-8">
        <div class="container mx-auto text-center text-gray-400">
             <div class="flex justify-center space-x-6 rtl:space-x-reverse mb-6">
                <a href="#" class="hover:text-yellow-400">Facebook</a>
                <a href="#" class="hover:text-yellow-400">Twitter</a>
                <a href="#" class="hover:text-yellow-400">Instagram</a>
            </div>
            <p id="copyright-notice" class="cursor-pointer">جميع الحقوق محفوظة &copy; 2025 Aymen Foot</p>
            <a href="#" class="hover:text-yellow-400">اتصل بنا</a>
        </div>
    </footer>
    
    <!-- Modals -->
    <div id="admin-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-sm">
            <h3 class="text-2xl font-bold text-white mb-4 text-center">دخول الأدمن</h3>
            <div class="space-y-4">
                <input type="password" id="admin-password-input" class="w-full bg-gray-700 text-white rounded-md p-3 border border-gray-600" placeholder="••••••••">
                <p id="modal-error-msg" class="text-red-500 text-sm text-center hidden">كلمة مرور خاطئة!</p>
                <button id="admin-submit-btn" class="w-full bg-yellow-500 text-black font-bold py-3 rounded-md">دخول</button>
                <button id="admin-cancel-btn" class="w-full bg-gray-600 text-white font-bold py-3 rounded-md">إلغاء</button>
            </div>
        </div>
    </div>
    
    <div id="control-panel-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[100] p-4">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-4xl max-h-full overflow-y-auto">
            <h2 class="text-2xl font-bold text-white mb-4">لوحة التحكم</h2>

            <!-- Leagues & Teams Management -->
            <div class="control-panel-section">
                 <h3 class="text-lg font-semibold mb-2">إدارة الدوريات والفرق</h3>
                 <div class="flex items-center gap-2 mb-4">
                    <select id="admin-league-selector" class="w-full bg-gray-700 text-white rounded p-2 border border-gray-600"></select>
                    <button id="admin-add-league-btn" class="bg-blue-500 p-2 rounded" title="إضافة دوري">➕</button>
                    <button id="admin-delete-league-btn" class="bg-red-500 p-2 rounded" title="حذف الدوري">🗑️</button>
                 </div>
                 <div id="admin-teams-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                 <button id="admin-add-team-btn" class="w-full mt-2 bg-green-600 text-white p-2 rounded">إضافة فريق جديد</button>
            </div>

            <!-- Rounds & Matches Management -->
            <div class="control-panel-section">
                <h3 class="text-lg font-semibold mb-2">إدارة الجولات والمباريات</h3>
                <div class="flex items-center gap-2 mb-4">
                    <select id="admin-round-selector" class="w-full bg-gray-700 text-white rounded p-2 border border-gray-600"></select>
                    <button id="set-upcoming-round-btn" class="bg-yellow-600 text-white p-2 rounded text-sm whitespace-nowrap">عرض كمباريات قادمة</button>
                    <button id="set-results-round-btn" class="bg-green-700 text-white p-2 rounded text-sm whitespace-nowrap">عرض كآخر النتائج</button>
                    <button id="admin-add-round-btn" class="bg-blue-500 p-2 rounded" title="إضافة جولة جديدة">➕</button>
                </div>
                <div id="admin-matches-list" class="space-y-2 mb-4 max-h-48 overflow-y-auto"></div>
                <div id="admin-add-match-form" class="flex gap-2 items-end">
                    <select id="admin-team1-select" class="w-1/3 bg-gray-700 text-white rounded p-2 border border-gray-600"></select>
                    <span class="font-bold">vs</span>
                    <select id="admin-team2-select" class="w-1/3 bg-gray-700 text-white rounded p-2 border border-gray-600"></select>
                    <input type="text" id="admin-match-time" class="w-1/6 bg-gray-700 text-white rounded p-2 border border-gray-600" value="00:00">
                    <input type="text" id="admin-match-date" class="w-1/4 bg-gray-700 text-white rounded p-2 border border-gray-600" placeholder="التاريخ">
                    <button id="admin-add-match-btn" class="bg-green-600 text-white p-2 rounded">إضافة</button>
                </div>
            </div>

            <!-- News Management -->
            <div class="control-panel-section">
                 <h3 class="text-lg font-semibold mb-2">إدارة الأخبار</h3>
                 <div id="admin-news-list" class="space-y-2 mb-4 max-h-40 overflow-y-auto"></div>
                 <div class="flex gap-2">
                     <input type="text" id="admin-news-input" class="w-full bg-gray-700 text-white rounded p-2 border border-gray-600" placeholder="اكتب الخبر...">
                     <button id="admin-add-news-btn" class="bg-green-600 text-white p-2 rounded">إضافة</button>
                 </div>
            </div>

            <button id="close-control-panel-btn" class="w-full mt-4 bg-gray-600 text-white p-2 rounded">إغلاق</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        let isAdmin = false;
        let data = {};
        let db;
        
        const firebaseConfig = {
            apiKey: "AIzaSyDfmtZppMrjm7E_MXC3gMAavtVFVm1xbtw",
            authDomain: "jjji-b7095.firebaseapp.com",
            databaseURL: "https://jjji-b7095-default-rtdb.firebaseio.com",
            projectId: "jjji-b7095",
            storageBucket: "jjji-b7095.appspot.com",
            messagingSenderId: "301036501127",
            appId: "1:301036501127:web:967e1e6402b23000782022",
            measurementId: "G-B2J2VFV82B"
        };
        
        async function saveData() {
            if (!db) return;
            try {
                await setDoc(doc(db, "sports-app", "main-data"), data);
            } catch (e) { console.error("Error saving data: ", e); }
        }

        function setupRealtimeListener() {
            onSnapshot(doc(db, "sports-app", "main-data"), (doc) => {
                if (doc.exists()) {
                    data = doc.data();
                    if (!data.leagues) data.leagues = [];
                    if (!data.news) data.news = [];
                } else {
                    data = { leagues: [{ name: "الدوري الافتراضي", currentRound: 0, lastResultsRound: 0, teams: [], schedule: {} }], news: ["مرحباً بك في موقع Aymen Foot الرياضي!"] };
                }
                renderAll();
                if (!document.getElementById('control-panel-modal').classList.contains('hidden')) {
                    renderControlPanel();
                }
            });
        }
        
        function getLeague(leagueName) {
            return data.leagues.find(l => l.name === leagueName);
        }

        function calculateStandings(leagueName) {
            const league = getLeague(leagueName);
            if (!league) return [];
            league.teams.forEach(t => { t.p=0; t.w=0; t.d=0; t.l=0; t.gf=0; t.ga=0; t.pts=0; });
            for (const roundNum in league.schedule) {
                league.schedule[roundNum].forEach(match => {
                    if (match.status && match.status !== 'normal') return; 
                    const s1 = parseInt(match.score1), s2 = parseInt(match.score2);
                    if (isNaN(s1) || isNaN(s2)) return;
                    const t1 = league.teams.find(t => t.name === match.team1);
                    const t2 = league.teams.find(t => t.name === match.team2);
                    if (!t1 || !t2) return;
                    t1.p++; t2.p++; t1.gf += s1; t1.ga += s2; t2.gf += s2; t2.ga += s1;
                    if (s1 > s2) { t1.w++; t1.pts += 3; t2.l++; }
                    else if (s2 > s1) { t2.w++; t2.pts += 3; t1.l++; }
                    else { t1.d++; t2.d++; t1.pts++; t2.pts++; }
                });
            }
            league.teams.sort((a, b) => b.pts - a.pts || (b.gf - b.ga) - (a.gf - a.ga) || b.gf - a.gf || a.name.localeCompare(b.name));
            return league.teams;
        }

        function renderAll() {
            const selectedLeague = document.getElementById('league-selector').value || (data.leagues[0] ? data.leagues[0].name : '');
            renderLeaguesDropdown(selectedLeague);
            renderMatches(selectedLeague);
            renderStandings(selectedLeague);
            renderResults(selectedLeague);
            renderNewsTicker();
        }

        function renderLeaguesDropdown(selectedValue) {
            const selector = document.getElementById('league-selector');
            selector.innerHTML = data.leagues.map(l => `<option ${l.name === selectedValue ? 'selected' : ''}>${l.name}</option>`).join('');
        }

        function renderMatches(leagueName) {
            const container = document.getElementById('matches-container');
            const league = getLeague(leagueName);
            const title = document.getElementById('upcoming-matches-title');
            if (!league || !league.currentRound || !league.schedule || !league.schedule[league.currentRound]) {
                title.textContent = "المباريات القادمة";
                container.innerHTML = `<p class="text-gray-400 text-center col-span-full">لم يتم تحديد جولة قادمة.</p>`; return;
            }
            title.textContent = `المباريات القادمة (الجولة ${league.currentRound})`;
            container.innerHTML = league.schedule[league.currentRound].map(match => {
                const team1 = league.teams.find(t => t.name === match.team1);
                const team2 = league.teams.find(t => t.name === match.team2);
                let matchCenterContent;
                if (match.status === 'postponed') {
                    matchCenterContent = `<div class="font-bold text-lg text-yellow-400">مؤجلة</div>`;
                } else if (match.status === 'stopped') {
                    matchCenterContent = `<div class="font-bold text-lg text-red-500">متوقفة</div>`;
                } else {
                    matchCenterContent = `<div class="font-bold text-lg">${match.time}</div><div class="text-xs text-gray-400">${match.date}</div>`;
                }
                return `
                <div class="card rounded-lg p-4 flex items-center justify-between">
                    <div class="w-1/3 text-center"><img src="${team1?.logo || 'https://placehold.co/50x50/333/FFF?text=??'}" class="mx-auto h-10 w-10 object-contain mb-2 rounded-full"><span class="font-bold">${match.team1}</span></div>
                    <div class="text-center">${matchCenterContent}</div>
                    <div class="w-1/3 text-center"><img src="${team2?.logo || 'https://placehold.co/50x50/333/FFF?text=??'}" class="mx-auto h-10 w-10 object-contain mb-2 rounded-full"><span class="font-bold">${match.team2}</span></div>
                </div>`;
            }).join('');
        }
        
        function renderStandings(leagueName) {
            const tbody = document.getElementById('standings-tbody');
            const standings = calculateStandings(leagueName);
            if (!standings || standings.length === 0) {
                tbody.innerHTML = `<tr><td colspan="8" class="text-center py-8 text-gray-400">لا توجد فرق في هذا الدوري.</td></tr>`; return;
            }
            tbody.innerHTML = standings.map((team, index) => `
                <tr class="hover:bg-gray-700">
                    <td class="py-3 px-2 font-bold">${index + 1}</td>
                    <td class="py-3 px-4 text-right"><div class="flex items-center gap-3"><img src="${team.logo || 'https://placehold.co/40x40/333/FFF?text=??'}" class="w-6 h-6 object-contain"><span>${team.name}</span></div></td>
                    <td>${team.p}</td><td>${team.w}</td><td>${team.d}</td><td>${team.l}</td><td>${team.gf}:${team.ga}</td>
                    <td class="font-bold text-lg text-yellow-400">${team.pts}</td>
                </tr>`).join('');
        }

        function renderResults(leagueName) {
            const container = document.getElementById('results-container');
            const league = getLeague(leagueName);
            const title = document.getElementById('latest-results-title');
            if (!league || !league.lastResultsRound || !league.schedule || !league.schedule[league.lastResultsRound]) {
                title.textContent = "النتائج الأخيرة";
                container.innerHTML = `<p class="text-gray-400 text-center">لم يتم تحديد جولة نتائج أخيرة.</p>`; return;
            }
            title.textContent = `النتائج الأخيرة (الجولة ${league.lastResultsRound})`;
            container.innerHTML = league.schedule[league.lastResultsRound].map(result => {
                const team1 = league.teams.find(t => t.name === result.team1);
                const team2 = league.teams.find(t => t.name === result.team2);
                let scoreContent;
                 if (result.status === 'postponed') {
                    scoreContent = `<div class="font-bold text-lg text-yellow-400">مؤجلة</div>`;
                } else if (result.status === 'stopped') {
                    scoreContent = `<div class="font-bold text-lg text-red-500">متوقفة</div>`;
                } else {
                    scoreContent = `<div class="bg-gray-900 px-3 py-1 rounded-md text-2xl font-black">${result.score1 ?? '?'} - ${result.score2 ?? '?'}</div>`;
                }
                return `
                <div class="mb-8 relative border-r-4 border-yellow-500 pr-8">
                    <div class="card p-4"><div class="flex items-center justify-between">
                        <div class="w-2/5 flex items-center justify-end gap-3"><span class="font-bold text-lg text-right">${result.team1}</span><img src="${team1?.logo || 'https://placehold.co/50x50/333/FFF?text=??'}" class="w-8 h-8 object-contain rounded-full"></div>
                        ${scoreContent}
                        <div class="w-2/5 flex items-center justify-start gap-3"><img src="${team2?.logo || 'https://placehold.co/50x50/333/FFF?text=??'}" class="w-8 h-8 object-contain rounded-full"><span class="font-bold text-lg text-left">${result.team2}</span></div>
                    </div></div>
                </div>`;
            }).join('');
        }
        
        function renderNewsTicker() {
            const container = document.getElementById('news-ticker-content');
            if (!data.news || data.news.length === 0) { container.innerHTML = `<p>لا توجد أخبار حالياً.</p>`; return; }
            const newsHtml = data.news.map(item => `<span class="mx-6">${item}</span>`).join('');
            container.innerHTML = `<p class="whitespace-nowrap animate-marquee">${newsHtml}</p><style>@keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } } .animate-marquee { display: inline-block; animation: marquee ${data.news.length * 15}s linear infinite; }</style>`;
        }
        
        function renderControlPanel() {
            const leagueSelector = document.getElementById('admin-league-selector');
            leagueSelector.innerHTML = data.leagues.map(l => `<option>${l.name}</option>`).join('');
            renderAdminPanelForLeague(leagueSelector.value);
            renderAdminNews();
        }

        function renderAdminPanelForLeague(leagueName) {
            const league = getLeague(leagueName);
            if (!league) return;
            const teamsList = document.getElementById('admin-teams-list');
            const roundSelector = document.getElementById('admin-round-selector');
            const team1Select = document.getElementById('admin-team1-select');
            const team2Select = document.getElementById('admin-team2-select');
            
            teamsList.innerHTML = league.teams.map((team, index) => `
                <div class="flex gap-2 items-center"><input type="text" value="${team.name}" onchange="app.updateTeam(${index}, 'name', this.value)" class="w-1/3 p-1 bg-gray-900 rounded"><input type="text" value="${team.logo || ''}" onchange="app.updateTeam(${index}, 'logo', this.value)" class="w-2/3 p-1 bg-gray-900 rounded" placeholder="رابط الشعار"><button onclick="app.deleteTeam(${index})" class="text-red-500">🗑️</button></div>`).join('');
            
            roundSelector.innerHTML = Object.keys(league.schedule || {}).map(r => `<option>${r}</option>`).join('');
            renderAdminMatchesForRound(leagueName, roundSelector.value);

            const teamOptions = league.teams.map(t => `<option>${t.name}</option>`).join('');
            team1Select.innerHTML = teamOptions;
            team2Select.innerHTML = teamOptions;
        }
        
        function renderAdminMatchesForRound(leagueName, roundNum) {
            const league = getLeague(leagueName);
            const matchesList = document.getElementById('admin-matches-list');
            if (!league || !roundNum || !league.schedule[roundNum]) { matchesList.innerHTML = ''; return; }
            matchesList.innerHTML = league.schedule[roundNum].map((match, index) => `
                <div class="flex gap-2 items-center text-sm">
                    <span class="flex-1">${match.team1} vs ${match.team2}</span>
                    <select onchange="app.updateMatchStatus(${roundNum}, ${index}, this.value)" class="p-1 bg-gray-900 rounded">
                        <option value="normal" ${!match.status || match.status === 'normal' ? 'selected' : ''}>عادي</option>
                        <option value="postponed" ${match.status === 'postponed' ? 'selected' : ''}>مؤجلة</option>
                        <option value="stopped" ${match.status === 'stopped' ? 'selected' : ''}>متوقفة</option>
                    </select>
                    <input type="number" value="${match.score1 ?? ''}" onchange="app.updateScore(${roundNum}, ${index}, 'score1', this.value)" class="w-12 p-1 bg-gray-900 rounded">
                    <input type="number" value="${match.score2 ?? ''}" onchange="app.updateScore(${roundNum}, ${index}, 'score2', this.value)" class="w-12 p-1 bg-gray-900 rounded">
                    <button onclick="app.deleteMatch(${roundNum}, ${index})" class="text-red-500">🗑️</button>
                </div>`).join('');
        }

        function renderAdminNews() {
            const newsList = document.getElementById('admin-news-list');
            newsList.innerHTML = (data.news || []).map((item, index) => `
                <div class="flex justify-between items-center bg-gray-700 p-2 rounded"><span>${item}</span><button onclick="app.deleteNews(${index})" class="text-red-500">🗑️</button></div>`).join('');
        }

        window.app = {
            addLeague: () => { const n=prompt("اسم الدوري؟"); if(n&&!getLeague(n)){ data.leagues.push({name:n, currentRound:0, lastResultsRound:0, teams:[], schedule:{}}); saveData(); } },
            deleteLeague: () => { const n=document.getElementById('admin-league-selector').value; if(confirm(`تأكيد حذف دوري "${n}"؟`)){ data.leagues = data.leagues.filter(l => l.name !== n); saveData(); } },
            addTeam: () => { const n=prompt("اسم الفريق؟"); const l=getLeague(document.getElementById('admin-league-selector').value); if(n&&l&&!l.teams.find(t=>t.name===n)){ l.teams.push({name: n, logo: ''}); saveData(); } },
            updateTeam: (i, f, v) => { const l=getLeague(document.getElementById('admin-league-selector').value); const oldN=l.teams[i].name; l.teams[i][f]=v; if(f==='name'){ for(const r in l.schedule){ l.schedule[r].forEach(m=>{ if(m.team1===oldN)m.team1=v; if(m.team2===oldN)m.team2=v; }); } } saveData(); },
            deleteTeam: (i) => { const l=getLeague(document.getElementById('admin-league-selector').value); l.teams.splice(i, 1); saveData(); },
            addRound: () => { const l=getLeague(document.getElementById('admin-league-selector').value); const maxR=Math.max(0,...Object.keys(l.schedule || {}).map(Number)); if(!l.schedule) l.schedule = {}; l.schedule[maxR+1]=[]; saveData(); },
            addMatch: () => { const lN=document.getElementById('admin-league-selector').value, rN=document.getElementById('admin-round-selector').value; const l=getLeague(lN); const t1=document.getElementById('admin-team1-select').value, t2=document.getElementById('admin-team2-select').value; if(t1===t2){alert("لا يمكن للفريق اللعب ضد نفسه");return;} l.schedule[rN].push({id:Date.now(), team1:t1, team2:t2, time:document.getElementById('admin-match-time').value, date:document.getElementById('admin-match-date').value, score1:null, score2:null, status: 'normal'}); saveData(); },
            deleteMatch: (r, i) => { getLeague(document.getElementById('admin-league-selector').value).schedule[r].splice(i, 1); saveData(); },
            updateScore: (r, i, s, v) => { getLeague(document.getElementById('admin-league-selector').value).schedule[r][i][s]=v; saveData(); },
            updateMatchStatus: (r, i, status) => { getLeague(document.getElementById('admin-league-selector').value).schedule[r][i].status = status; saveData(); },
            setUpcoming: () => { const l=getLeague(document.getElementById('admin-league-selector').value); l.currentRound = document.getElementById('admin-round-selector').value; saveData(); alert("تم التحديث"); },
            setResults: () => { const l=getLeague(document.getElementById('admin-league-selector').value); l.lastResultsRound = document.getElementById('admin-round-selector').value; saveData(); alert("تم التحديث"); },
            addNews: () => { const i=document.getElementById('admin-news-input'); if(i.value){ if(!data.news) data.news = []; data.news.unshift(i.value.trim()); i.value=''; saveData(); } },
            deleteNews: (i) => { data.news.splice(i, 1); saveData(); }
        };

        function setAdminMode(enabled) {
            isAdmin = enabled;
            document.getElementById('admin-banner').classList.toggle('hidden', !enabled);
            if(enabled) { document.getElementById('admin-message').textContent = 'وضع الأدمن مفعل (اضغط هنا للخروج)'; document.getElementById('admin-message').addEventListener('click', handleAdminLogout); }
             else { document.getElementById('admin-message').removeEventListener('click', handleAdminLogout); }
        }
        
        function showAdminModal() { document.getElementById('admin-modal').classList.remove('hidden'); document.getElementById('admin-password-input').focus(); }
        function hideAdminModal() { document.getElementById('admin-modal').classList.add('hidden'); document.getElementById('admin-password-input').value = ''; document.getElementById('modal-error-msg').classList.add('hidden'); }
        function checkAdminPassword() { 
            if (document.getElementById('admin-password-input').value === '200411') { 
                setAdminMode(true); 
                hideAdminModal(); 
                renderControlPanel();
                document.getElementById('control-panel-modal').classList.remove('hidden');
            } else { 
                document.getElementById('modal-error-msg').classList.remove('hidden'); 
            } 
        }
        function handleAdminLogin() { if (!isAdmin) showAdminModal(); }
        function handleAdminLogout() { setAdminMode(false); }
        
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                const auth = getAuth(app);
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        setupRealtimeListener();
                    } else {
                        signInAnonymously(auth).catch((error) => console.error("Anonymous sign-in failed:", error));
                    }
                });
            } catch (e) {
                console.error("Firebase init failed:", e);
                alert("فشل الاتصال بقاعدة البيانات.");
            }
            document.getElementById('copyright-notice').addEventListener('click', handleAdminLogin);
            document.getElementById('admin-submit-btn').addEventListener('click', checkAdminPassword);
            document.getElementById('admin-password-input').addEventListener('keyup', e => { if (e.key === 'Enter') checkAdminPassword(); });
            document.getElementById('admin-cancel-btn').addEventListener('click', hideAdminModal);
            document.getElementById('theme-toggle').addEventListener('click', () => document.documentElement.classList.toggle('light'));
            document.getElementById('league-selector').addEventListener('change', renderAll);
            document.getElementById('open-control-panel-btn').addEventListener('click', () => { renderControlPanel(); document.getElementById('control-panel-modal').classList.remove('hidden'); });
            document.getElementById('close-control-panel-btn').addEventListener('click', () => document.getElementById('control-panel-modal').classList.add('hidden'));
            document.getElementById('admin-league-selector').addEventListener('change', (e) => renderAdminPanelForLeague(e.target.value));
            document.getElementById('admin-round-selector').addEventListener('change', (e) => renderAdminMatchesForRound(document.getElementById('admin-league-selector').value, e.target.value));
            document.getElementById('admin-add-league-btn').addEventListener('click', window.app.addLeague);
            document.getElementById('admin-delete-league-btn').addEventListener('click', window.app.deleteLeague);
            document.getElementById('admin-add-team-btn').addEventListener('click', window.app.addTeam);
            document.getElementById('admin-add-round-btn').addEventListener('click', window.app.addRound);
            document.getElementById('admin-add-match-btn').addEventListener('click', window.app.addMatch);
            document.getElementById('set-upcoming-round-btn').addEventListener('click', window.app.setUpcoming);
            document.getElementById('set-results-round-btn').addEventListener('click', window.app.setResults);
            document.getElementById('admin-add-news-btn').addEventListener('click', window.app.addNews);
        });
    </script>
</body>
</html>

